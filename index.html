<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Checklist</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=Promise%2CObject.assign%2CString.prototype.includes"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 15px; background-color: #f0f2f5; color: #333; overflow-x: hidden;}
        /* Ajuste para caber na barra lateral estreita do Outlook */
        .container { background-color: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); width: 100%; box-sizing: border-box;}
        h2 { font-size: 18px; color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-top: 0; }
        
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-size: 12px; font-weight: 600; color: #555; }
        
        input, textarea, select { 
            width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 13px; 
        }
        textarea { resize: vertical; min-height: 60px; }

        .input-erro { border-color: #e74c3c !important; background-color: #fff5f5; }
        
        button { 
            width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 4px; font-weight: bold; cursor: pointer; color: white;
        }
        .btn-gerar { background-color: #3498db; }
        .btn-copiar { background-color: #27ae60; display: none; }
        .btn-email { background-color: #e67e22; display: none; }

        #imagem-final-container { margin-top: 20px; text-align: center; border: 1px dashed #ccc; padding: 10px; display: none;}
        #imagem-final-container canvas { max-width: 100%; height: auto; }

        /* CSS Oculto */
        #wrapper-oculto { position: absolute; left: -9999px; top: 0; }
        #area-para-imagem { width: 600px; background: white; padding: 30px; border: 1px solid #e0e0e0; font-family: Arial, sans-serif; }
        
        .tabela-resumo { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .tabela-resumo td { padding: 8px; border-bottom: 1px solid #eee; vertical-align: top; font-size: 14px;}
        .tb-label { font-weight: bold; color: #555; width: 40%; background-color: #f9f9f9; }
    </style>
</head>
<body>

<div class="container">
    <h2>Checklist Cancelamento</h2>
    
    <div class="form-group">
        <label>Código - Razão Social: * (Min. 6)</label>
        <input type="text" id="cod_razao" placeholder="AAAA00 - EMPRESA" maxlength="60">
    </div>

    <div class="form-group">
        <label>E-mail envio termo: *</label>
        <input type="email" id="email">
    </div>

    <div class="form-group">
        <label>Data Cancelamento: *</label>
        <input type="date" id="data">
    </div>
    
    <div class="form-group">
        <label>Ciente Nova Fatura? *</label>
        <select id="ciente">
            <option value="Sim">Sim</option>
            <option value="Não">Não</option>
        </select>
    </div>

    <div class="form-group">
        <label>Descrição Solicitação: *</label>
        <textarea id="descricao"></textarea>
    </div>

    <div class="form-group">
        <label>Motivo Cancelamento: *</label>
        <select id="motivo_cancelamento">
            <option value="">Selecione...</option>
            <option value="1">1 - CLIENTE INADIMPLENTE NA TELECHEQUE</option>
            <option value="2">2 - (T) MIGRACAO PARA OUTRO SERVICO TELECHEQUE</option>
            <option value="3">3 - (T) CLIENTE NAO CONCORDA COM RENEGOCIACAO</option>
            <option value="4">4 - (T) IMPLANTACAO NAO REALIZADA PELA TELECHEQUE</option>
            <option value="6">6 - (C) QUALIDADE DO SERVICO INSATISFATORIA</option>
            <option value="7">7 - (C) QUALIDADE DO ATENDIMENTO INSATISFATORIA</option>
            <option value="8">8 - (C) MIGRACAO PARA CONCORRENCIA POR PRECO</option>
            <option value="9">9 - PROBLEMAS ECONÔMICOS OU FINANCEIROS</option>
            <option value="10">10 - ENCERRAMENTO DA ATIVIDADE COMERCIAL</option>
            <option value="11">11 - (C) CLIENTE NAO CONCORDOU COM IMPLANTACAO</option>
            <option value="13">13 - (C) PROBLEMAS COM RESSARCIMENTO</option>
            <option value="14">14 - BAIXAS VENDAS COM CHEQUE</option>
            <option value="20">20 - SUSPENSO AUTOMATICAMENTE POR ATRASO PAGAMENTO</option>
            <option value="24">24 - MIGRACAO PARA GOODCHECK</option>
            <option value="26">26 - FALTA DE ESCLARECIMENTO NA VENDAS</option>
            <option value="27">27 - CLI NAO CONCORDOU IMPLANT- REPENSOU SOBRE PRODUTO</option>
            <option value="28">28 - NAO ACATAMENTO DE CHEQUES-CONDICOES COMERCIAIS</option>
            <option value="29">29 - MIGRACAO PARA CONCORRENCIA-POR PRODUTO</option>
            <option value="34">34 - (C) OUTROS MOTIVOS</option>
            <option value="35">35 - CANCELAMENTO DE USUÁRIO</option>
            <option value="37">37 - (C) RISCO ELEVADO</option>
            <option value="38">38 - ERRO DE GESTÃO DO PÓS-VENDAS</option>
            <option value="39">39 - (C) AJUSTE ALTO</option>
            <option value="41">41 - REDUÇÃO DE CUSTOS DO CLIENTE</option>
            <option value="42">42 - (C) VOLUME CONT NAO EH ADEQUADO POTENCIAL CLIENTE</option>
            <option value="45">45 - CLIENTE NÃO TRABALHA MAIS COM CHEQUE</option>
            <option value="46">46 - MIGRAÇÃO PARA CONCORRÊNCIA POR QUALIDADE</option>
            <option value="50">50 - EMPRESA VENDIDA SEM NOVA NEGOCIAÇÃO</option>
            <option value="52">52 - (C) VENDA DA EMPRESA - MUDANCA SOCIETARIA</option>
            <option value="53">53 - (C) NAO ATENDEMOS AS ESPECTATIVAS DO CLIENTE</option>
            <option value="54">54 - (C) FALTA DE ACOMPANHAMENTO ADEQUADO</option>
            <option value="56">56 - (C) ALTO INDICE DE NEGADOS</option>
            <option value="57">57 - (C) CLIENTE COM DIRECIONAMENTO DE CHEQUES</option>
            <option value="58">58 - NÃO ACATAMENTO DE CH SOMADO AO AJUSTE DE TAXA</option>
            <option value="60">60 - (C) MIGRACAO P/ CONCORRENCIA - CARTAO/FINANCEIRA</option>
            <option value="64">64 - DESENTENDIMENTO INTERNO ENTRE OS SÓCIOS</option>
            <option value="66">66 - (C) SOLICITACAO DE DE X PARA</option>
            <option value="67">67 - PROBLEMAS COM MEIO DE ACESSO</option>
            <option value="71">71 - (T) CLIENTE COM BAIXA RENTABILIDADE</option>
            <option value="72">72 - CONTRATO C/ MC NEGATIVA - CLIENTE NÃO ACEITOU RENEGOCIAÇÃO</option>
            <option value="74">74 - CLIENTE NÃO ACEITA RESSARCIMENTO PARCIAL - SUST/ROUB</option>
            <option value="75">75 - CLIENTE N ACEITA AJUSTE/RISCO ALTO</option>
            <option value="76">76 - CLIENTE NÃO ACEITA OMC</option>
            <option value="77">77 - CLIENTE NÃO ACEITA PRAZO DE ACATAMENTO</option>
            <option value="80">80 - MIGRAÇÃO PARA CONCORRÊNCIA POR PREÇO</option>
            <option value="81">81 - CLIENTE NÃO ACEITOU IMPLANTAÇÃO - PROB.NA VENDA</option>
            <option value="83">83 - MIGRAÇÃO PARA FINANCEIRA</option>
            <option value="84">84 - DEMORA NO ATENDIMENTO DO POS-VENDAS</option>
            <option value="86">86 - EXPECTATIVA NAO ATENDIDA - VENDAS</option>
            <option value="100">100 - CLIENTE INADIMPLENTE NA MULTI-CRÉDITO</option>
            <option value="101">101 - CLIENTE COM BAIXAS VENDAS NO CREDIÁRIO</option>
            <option value="102">102 - CLIENTE DEIXOU DE TRABALHAR COM CREDIÁRIO</option>
            <option value="104">104 - CLIENTE SEM PERFIL</option>
            <option value="105">105 - NÃO ACATAMENTO DE DUPLICATAS/ COND. COMERCIAIS</option>
            <option value="111">111 - CANCELADO POR FRAUDE CLIENTE</option>
            <option value="112">112 - EXPECTATIVA NÃO ATENDIDA - PRODUTO</option>
            <option value="113">113 - CREDIARIO MUITO BUROCRATICO</option>
            <option value="115">115 - TAXAS ALTAS</option>
            <option value="118">118 - PROBLEMAS NA CADEIA DO CHEQUE</option>
            <option value="120">120 - FALTA DE ESTRUTURA - EQUIPAMENTO</option>
            <option value="122">122 - CUSTO VERSUS BENEFICIO</option>
            <option value="123">123 - PROCESSO DO CHEQUE MUITO BUROCRATICO</option>
            <option value="124">124 - CONSUMIDOR NAO ADERENTE AO MEIO DE PAGAM CHEQUE</option>
            <option value="125">125 - QUEDA NAS VENDAS GERAL SITUACAO DE MERCADO</option>
            <option value="126">126 - CLIENTE IMPLANTOU CREDIARIO PROPRIO</option>
            <option value="128">128 - FALTA DE ANTECIPAÇÃO</option>
            <option value="130">130 - ERRO DE VENDAS</option>
            <option value="131">131 - CLIENTE NÃO ACEITA TARIFAS TAP/TGO</option>
            <option value="132">132 - CONSUMIDOR NÃO ADERENTE AO MEIO DE PAGAMENTO CREDIÁRIO</option>
            <option value="133">133 - PROBLEMAS COM INTEGRAÇAO BANCÁRIA</option>
            <option value="134">134 - LIMITE DE CREDITO BAIXO PARA O CONSUMIDOR</option>
            <option value="135">135 - MIGRAÇÃO PARA SERVIÇO METTADADOS</option>
            <option value="904">904 - CANCELADO A PEDIDO DO CLIENTE</option>
            <option value="909">909 - FALTA DE ANTECIPAÇÃO</option>
        </select>
    </div>

    <div class="form-group">
        <label>Falha Renegociação: *</label>
        <textarea id="renegociacao"></textarea>
    </div>

    <div class="form-group">
        <label>Propostas Reversão: *</label>
        <textarea id="propostas"></textarea>
    </div>

    <div class="form-group">
        <label>Registro Visita (120 dias):</label>
        <input type="file" id="upload-imagem" accept="image/*">
    </div>

    <button id="btn-gerar" class="btn-gerar">Gerar Imagem</button>
    <button id="btn-copiar" class="btn-copiar">Copiar</button>
    <button id="btn-email" class="btn-email">E-mail</button>

    <div id="imagem-final-container"></div>
</div>

<div id="wrapper-oculto">
    <div id="area-para-imagem">
        <h3 style="color:#d9534f; border-bottom:2px solid #d9534f;">Diagnóstico de Cancelamento</h3>
        <table class="tabela-resumo">
            <tr><td class="tb-label">Cód - Razão Social:</td><td class="tb-valor" id="res-cod-razao"></td></tr>
            <tr><td class="tb-label">E-mail:</td><td class="tb-valor" id="res-email"></td></tr>
            <tr><td class="tb-label">Data:</td><td class="tb-valor" id="res-data"></td></tr>
            <tr><td class="tb-label">Ciente Fatura?</td><td class="tb-valor" id="res-ciente"></td></tr>
            <tr><td class="tb-label">Descrição:</td><td class="tb-valor" id="res-descricao"></td></tr>
            <tr><td class="tb-label" style="color:#d9534f;">MOTIVO:</td><td class="tb-valor" id="res-motivo" style="font-weight:bold;"></td></tr>
            <tr><td class="tb-label">Falha Renegociação:</td><td class="tb-valor" id="res-renegociacao"></td></tr>
            <tr><td class="tb-label">Propostas:</td><td class="tb-valor" id="res-propostas"></td></tr>
        </table>
        <div id="container-anexo" style="display:none; margin-top:20px; border-top:2px dashed #ccc; padding-top:10px; text-align:center;">
            <strong>Registro de Visita (120 dias):</strong><br>
            <img id="img-anexo-preview" src="" style="max-width:100%; border:1px solid #ddd; margin-top:5px;">
        </div>
    </div>
</div>

<script>
    // Código Javascript Compatível com IE11 (Sem 'const', 'let', '=>')
    var canvasGlobal = null;

    // Máscara Código
    document.getElementById('cod_razao').addEventListener('input', function(e) {
        var v = e.target.value.toUpperCase();
        if (v.length === 6 && v.indexOf(' - ') === -1) {
            v = v + ' - ';
        } else if (v.length > 6 && v.indexOf(' - ') === -1) {
            v = v.substring(0,6) + ' - ' + v.substring(6);
        }
        e.target.value = v;
    });

    // Upload
    document.getElementById('upload-imagem').addEventListener('change', function(e) {
        var file = e.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function(evt) {
                document.getElementById('img-anexo-preview').src = evt.target.result;
                document.getElementById('container-anexo').style.display = 'block';
            };
            reader.readAsDataURL(file);
        } else {
            document.getElementById('img-anexo-preview').src = "";
            document.getElementById('container-anexo').style.display = 'none';
        }
    });

    // Gerar Imagem
    document.getElementById('btn-gerar').addEventListener('click', function() {
        var cod = document.getElementById('cod_razao');
        var email = document.getElementById('email');
        var data = document.getElementById('data');
        var ciente = document.getElementById('ciente');
        var desc = document.getElementById('descricao');
        var motivo = document.getElementById('motivo_cancelamento');
        var reneg = document.getElementById('renegociacao');
        var prop = document.getElementById('propostas');

        // Validação Simples
        if(!cod.value || !email.value || !data.value || !desc.value || !motivo.value || !reneg.value || !prop.value) {
            alert("Preencha todos os campos.");
            return;
        }
        if(cod.value.length < 6) {
            alert("Código deve ter 6 dígitos.");
            return;
        }
        if(email.value.indexOf('@') === -1) {
            alert("E-mail inválido.");
            return;
        }

        // Preencher Oculto
        document.getElementById('res-cod-razao').innerText = cod.value.toUpperCase();
        document.getElementById('res-email').innerText = email.value;
        
        var d = data.value.split('-');
        document.getElementById('res-data').innerText = d[2]+'/'+d[1]+'/'+d[0];
        
        document.getElementById('res-ciente').innerText = ciente.value;
        document.getElementById('res-descricao').innerText = desc.value;
        document.getElementById('res-motivo').innerText = motivo.options[motivo.selectedIndex].text;
        document.getElementById('res-renegociacao').innerText = reneg.value;
        document.getElementById('res-propostas').innerText = prop.value;

        var imgContainer = document.getElementById('imagem-final-container');
        imgContainer.style.display = 'block';
        imgContainer.innerText = 'Gerando...';

        html2canvas(document.querySelector("#area-para-imagem"), {
            scale: 2,
            backgroundColor: "#ffffff"
        }).then(function(canvas) {
            canvasGlobal = canvas;
            imgContainer.innerHTML = '';
            imgContainer.appendChild(canvas);
            document.getElementById('btn-copiar').style.display = 'inline-block';
            document.getElementById('btn-email').style.display = 'inline-block';
            document.getElementById('btn-gerar').style.display = 'none';
        });
    });

    // Copiar
    document.getElementById('btn-copiar').addEventListener('click', function() {
        if(!canvasGlobal) return;
        canvasGlobal.toBlob(function(blob) {
            try {
                var item = new ClipboardItem({ "image/png": blob });
                navigator.clipboard.write([item]).then(function() {
                    alert("Copiado! Dê Ctrl+V no e-mail.");
                });
            } catch(e) {
                alert("Use botão direito > Copiar.");
            }
        });
    });

    // Email
    document.getElementById('btn-email').addEventListener('click', function() {
        if(!canvasGlobal) { alert("Gere a imagem primeiro."); return; }
        
        // Tenta copiar
        canvasGlobal.toBlob(function(blob) {
            try {
                var item = new ClipboardItem({ "image/png": blob });
                navigator.clipboard.write([item]);
            } catch(e) {}
        });

        alert("Imagem copiada! O e-mail abrirá em seguida. Cole com Ctrl+V.");

        var cod = document.getElementById('cod_razao').value.toUpperCase();
        var motivo = document.getElementById('motivo_cancelamento');
        var motivoTxt = motivo.options[motivo.selectedIndex].text;
        var subject = "RES: DIAGNÓSTICO DE CANCELAMENTO - " + cod + " - " + motivoTxt;
        var body = "Olá,\n\nSegue em anexo o diagnóstico de cancelamento: " + cod + "\n\nAtenciosamente,";
        
        window.location.href = "mailto:?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body);
    });

</script>

</body>
</html>